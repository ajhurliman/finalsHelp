!function(){"use strict"}(),angular.module("fh",["ngStorage","ui.router","ui.bootstrap","ui.bootstrap.showErrors","ui.utils","restangular","templates-app","templates-components","ApplicationConfiguration","fh.landing","fh.home","fh.search","fh.findAndEdit","fh.directives.mainHeader","fh.directives.modals.showPdfModal","fh.services.FocusService","vendor.steelToe","base64","angular-momentjs"]).config(["$urlRouterProvider","RestangularProvider","Configuration","$uiViewScrollProvider","$httpProvider",function(t,e,o,i,n){e.setBaseUrl("/api"),e.setDefaultHttpFields({withCredentials:!0,timeout:o.timeoutInMillis,cache:!0}),t.when("","/landing").otherwise("/landing"),i.useAnchorScroll()}]).run(["$rootScope","Configuration","$state","$sessionStorage",function(t,e,o,i){t.appName=e.appName,t.companyCode=e.companyCode,o.go("landing"),t.$on("$stateChangeStart",function(t,e,o,i,n){})}]).constant("AUTH_EVENTS",{loginSuccess:"auth-login-success",loginFailed:"auth-login-failed",logoutSuccess:"auth-logout-success",sessionTimeout:"auth-session-timeout",notAuthenticated:"auth-not-authenticated",notAuthorized:"auth-not-authorized"});
angular.module("fh.findAndEdit",["ui.select","ngStorage"]).config(["$stateProvider",function(e){e.state("findAndEdit",{url:"/findAndEdit",views:{main:{controller:"FindAndEditController",templateUrl:"findAndEdit/findAndEdit.tpl.html"}},pageTitle:"Find And Edit",resolve:{allClasses:["$http","$sessionStorage",function(e,n){return e({method:"GET",url:"api/classes/all",headers:{jwt:n.jwt}}).then(function(e){return e.data},function(e){console.log(e)})}]}})}]).controller("FindAndEditController",["$scope","$http","$sessionStorage","allClasses","$timeout",function(e,n,t,o,a){function d(e){var n=document.getElementById(e._id),t=n.getContext("2d");e?PDFJS.getDocument(e.img.data).then(function(e){e.getPage(1).then(function(e){var o=.4,a=e.getViewport(o);n.height=a.height,n.width=a.width;var d={canvasContext:t,viewport:a};e.render(d)})}):t.clearRect(0,0,n.width,n.height)}var i="/api/papers";n.defaults.headers.common.jwt=t.jwt,e.query={},e.editData={},e.allClasses=o,e.seasons=[{name:"Spring",code:"SP"},{name:"Summer",code:"SU"},{name:"Fall",code:"FA"},{name:"Winter",code:"WI"}],e.years=[{name:"95",code:"95"},{name:"96",code:"96"},{name:"97",code:"97"},{name:"98",code:"98"},{name:"99",code:"99"},{name:"00",code:"00"},{name:"01",code:"01"},{name:"02",code:"02"},{name:"03",code:"03"},{name:"04",code:"04"},{name:"05",code:"05"},{name:"06",code:"06"},{name:"07",code:"07"},{name:"08",code:"08"},{name:"09",code:"09"},{name:"10",code:"10"},{name:"11",code:"11"},{name:"12",code:"12"},{name:"13",code:"13"},{name:"14",code:"14"},{name:"15",code:"15"}],e.types=[{name:"Homework",code:"H"},{name:"Midterm",code:"M"},{name:"Notes",code:"N"},{name:"Quiz",code:"Q"},{name:"Final",code:"F"},{name:"Lab",code:"L"}],e.findClasses=function(t){n({method:"GET",url:i+"/classAndType/class/"+t.classId}).then(function(n){e.papers=n.data},function(e){console.log(e)})},e.$watch("papers",function(){e.papers&&a(function(){for(var n=0;n<e.papers.length;n++)d(e.papers[n])},100)}),e.showEditPanel=function(n){e["openEditPanel-"+n]=!e["openEditPanel-"+n]},e.isEditPanelOpen=function(n){return!!e["openEditPanel-"+n]},e.submitEditedPaper=function(e,t){putObj={title:t.title,period:t.season+t.year,type:t.type,classId:t.classId},e.success=n({method:"PUT",url:"api/papers/single/"+e._id,data:putObj}).then(function(e){return console.log(e),!0},function(e){return console.error(e),!1})}}]);
angular.module("fh.home",["ui.select","ngStorage","ngFileUpload","fh.services.FocusService"]).config(["$stateProvider",function(e){e.state("home",{url:"/home",views:{main:{controller:"HomeController",templateUrl:"home/home.tpl.html"}},pageTitle:"Home",resolve:{allClasses:["$http","$sessionStorage",function(e,t){return e({method:"GET",url:"api/classes/all",headers:{jwt:t.jwt}}).then(function(e){return e.data},function(e){console.log(e)})}],tokens:["$http",function(e){return e({method:"GET",url:"assets/tokens.json"}).then(function(e){return e.data},function(e){console.log(e)})}]}})}]).controller("HomeController",["$scope","$http","$sessionStorage","$timeout","giveFocus","Upload","allClasses","tokens",function(e,t,o,n,a,i,c,s){var l="/api/papers";t.defaults.headers.common.jwt=o.jwt,e.allClasses=c,e.$watch("files",function(){e.upload(e.files)}),e.$watch("file",function(){null!=e.file&&e.upload([e.file])}),e.log="",e.papersToEdit=[],e.editData={},e.seasons=[{name:"Spring",code:"SP"},{name:"Summer",code:"SU"},{name:"Fall",code:"FA"},{name:"Winter",code:"WI"}],e.years=[{name:"95",code:"95"},{name:"96",code:"96"},{name:"97",code:"97"},{name:"98",code:"98"},{name:"99",code:"99"},{name:"00",code:"00"},{name:"01",code:"01"},{name:"02",code:"02"},{name:"03",code:"03"},{name:"04",code:"04"},{name:"05",code:"05"},{name:"06",code:"06"},{name:"07",code:"07"},{name:"08",code:"08"},{name:"09",code:"09"},{name:"10",code:"10"},{name:"11",code:"11"},{name:"12",code:"12"},{name:"13",code:"13"},{name:"14",code:"14"},{name:"15",code:"15"}],e.types=[{name:"Homework",code:"H"},{name:"Midterm",code:"M"},{name:"Notes",code:"N"},{name:"Quiz",code:"Q"},{name:"Final",code:"F"},{name:"Lab",code:"L"}],e.upload=function(t){if(t&&t.length)for(var o=0;o<t.length;o++){var c=t[o];i.upload({url:l,file:c}).progress(function(t){var o=parseInt(100*t.loaded/t.total);e.log="progress: "+o+"%"+t.config.file.name+"\n"+e.log}).success(function(t,o,i,c){n(function(){e.log="file: "+c.file.name+", Response: "+JSON.stringify(t.title)+", ID: "+t._id,"\n"+e.log,e.papersToEdit.push(t),a("season-picker")})})}},e.submitEditedPaper=function(o,n){putObj={title:n.title,period:n.season+n.year,type:n.type,classId:n.classId},t({method:"PUT",url:"api/papers/single/"+o._id,data:putObj}).then(function(t){console.log(t),e.paperToEditBackStore=e.papersToEdit.shift()},function(e){console.error(e)})},e.$watch("papersToEdit[0]",function(){var t=document.getElementById("main-viewer"),o=t.getContext("2d");e.papersToEdit[0]?PDFJS.getDocument(e.papersToEdit[0].img.data).then(function(e){e.getPage(1).then(function(e){var n=.8,a=e.getViewport(n);t.height=a.height,t.width=a.width;var i={canvasContext:o,viewport:a};e.render(i)})}):o.clearRect(0,0,t.width,t.height)}),e.$watch("papersToEdit[1]",function(){var t=document.getElementById("next-up-pdf-container"),o=t.getContext("2d");e.papersToEdit[1]?PDFJS.getDocument(e.papersToEdit[1].img.data).then(function(e){e.getPage(1).then(function(e){var n=.2,a=e.getViewport(n);t.height=a.height,t.width=a.width;var i={canvasContext:o,viewport:a};e.render(i)})}):o.clearRect(0,0,t.width,t.height)}),e.addClass=function(o){var n={title:o};t({method:"POST",url:"/api/classes",data:n}).then(function(o){t({method:"GET",url:"/api/classes/all"}).then(function(t){e.allClasses=t.data})},function(e){console.log(e)})}}]);
angular.module("fh.landing",["ngStorage"]).config(["$stateProvider",function(e){e.state("landing",{url:"/",views:{main:{controller:"LandingController",templateUrl:"landing/landing.tpl.html"}},pageTitle:"landingPage.pageTitle"})}]).controller("LandingController",["$scope","$state","$http","$base64","$sessionStorage",function(e,n,o,r,a){var t="/api/users";e.register=function(r){var s={name:r.name,phone:r.phone,email:r.email,password:r.password,passwordConfirm:r.passwordConfirm,token:r.addCode};o({method:"POST",url:t,headers:{"Content-Type":"application/json"},data:s}).success(function(e){console.dir(e),a.jwt=e.jwt,n.go("search")}).error(function(n){e.registrationError=n,console.dir(n),e.registerCredentials.password="",e.registerCredentials.passwordConfirm=""})},e.login=function(e){o.defaults.headers.common.Authorization="Basic "+r.encode(e.email+":"+e.password),o.get(t).success(function(e){console.dir(e),a.jwt=e.jwt,n.go("search")}).error(function(e){console.dir(e)})}}]);
angular.module("fh.search",["ui.select","cgBusy","ngStorage"]).config(["$stateProvider",function(e){e.state("search",{url:"/search",views:{main:{controller:"SearchController",templateUrl:"search/search.tpl.html"}},pageTitle:"Search"})}]).controller("SearchController",["$scope","$http","$sessionStorage","$timeout",function(e,t,n,r){function o(t){var n=document.getElementById("display-paper"),r=n.getContext("2d");e.pdf.getPage(t).then(function(e){var t=1,o=e.getViewport(t);n.height=o.height,n.width=o.width;var a={canvasContext:r,viewport:o};e.render(a)})}function a(t){e.rendered=!0;var n=document.getElementById("display-paper"),r=n.getContext("2d");t?PDFJS.getDocument(t.img.data).then(function(t){t.getPage(1).then(function(e){var t=1,o=e.getViewport(t);n.height=o.height,n.width=o.width;var a={canvasContext:r,viewport:o};e.render(a)}),e.pdf=t,i=1,document.getElementById("previous-page").addEventListener("click",function(){i>1&&(i--,o(i))}),document.getElementById("next-page").addEventListener("click",function(){e.pdf.numPages>i&&(i++,o(i))})}):r.clearRect(0,0,n.width,n.height)}t.defaults.headers.common.jwt=n.jwt,e.rendered=!1,e.query={},e.sortPeriodReverse=!0;var i,c="/api/papers";t({method:"GET",url:"api/classes/all"}).then(function(t){e.allClasses=t.data},function(e){console.log(e)}),e.togglePeriodReverse=function(){e.sortPeriodReverse=!e.sortPeriodReverse},e.findPapersByClass=function(n){e.busyFindingPapers=t({method:"GET",url:c+"/class/"+n.classId}).then(function(t){e.papers=t.data},function(e){console.log(e)})},e.findImage=function(n){e.busyFindingPaperImage=t({method:"GET",url:c+"/single/"+n}).then(function(t){e.paper=t.data},function(e){console.log(e)})},e.period=function(e){var t={SP:.1,SU:.2,FA:.3,WI:.4},n=t[e.period.slice(0,2)],r=+e.period.slice(2,4);return r+=50>=r?2e3:1900,r+n},e.$watch("paper",function(){e.paper&&r(function(){a(e.paper)},100)})}]);
angular.module("fh.directives.mainHeader",["ngStorage","ApplicationConfiguration"]).directive("mainHeader",function(){return{restrict:"A",replace:!0,templateUrl:"directives/mainHeader/mainHeader.tpl.html",controller:["$scope","$state",function(e,r){}]}});
angular.module("fh.directives.modals.showPdfModal",["ui.bootstrap","fh.services.ModalService"]).directive("showPdfModal",["ModalService",function(o){return{restrict:"AE",link:function(e,t,d){t.on("click",function(){o.openModal({templateUrl:"directives/modals/showPdfModal/showPdfModal.tpl.html",controller:"ShowPdfModalController",windowClass:"show-pdf-modal",backdrop:"static",keyboard:!1,resolve:{paper:function(){return e.paper}}})})}}}]).controller("ShowPdfModalController",["$scope","$timeout","ModalService","paper",function(o,e,t,d){o.close=function(){t.closeModal()},o.modalId=d._id+"modal",o.paper=d,e(function(){var o=document.getElementById(d._id+"modal"),e=o.getContext("2d");d?PDFJS.getDocument(d.img.data).then(function(t){t.getPage(1).then(function(t){var d=1,l=t.getViewport(d);o.height=l.height,o.width=l.width;var r={canvasContext:e,viewport:l};t.render(r)})}):e.clearRect(0,0,o.width,o.height)},50)}]);
angular.module("fh.services.FindImageService",["ngStorage","vendor.steelToe"]).factory("FindImageService",["$http","$sessionStorage","$q","steelToe",function(e,r,n,o){function a(e,r){var o=n.defer(),a=new Image;return a.onerror=function(){o.resolve(r)},a.onload=function(){o.resolve(e)},a.src=e,o.promise}return{getHeaderImage:function(e){var r="./assets/images/headerImage.jpg";return a(r)}}}]);
angular.module("fh.services.FocusService",[]).factory("giveFocus",["$timeout",function(e){return function(u){e(function(){var e=document.getElementById(u);e&&e.focus()})}}]);
angular.module("fh.services.ModalService",["ui.bootstrap.modal"]).service("ModalService",["$rootScope","$modal",function(l,o){var a={modal:null,modalArgs:null,isModalOpen:function(){return null!==a.modal},openModal:function(l){return a.closeModal(),a.modalArgs=l,a.modal=o.open(l),a.modal},closeModal:function(){return null===a.modal?!1:(a.modal.dismiss(),a.modal=null,a.modalArgs=null,!0)}};return l.$on("$stateChangeStart",function(l,o,n,e,d){a.closeModal()}),a}]);